---
title: "Wake & Manipulate: Robot Arm"
description: "Rapid prototyping of a robotic arm, controller, and graphical user interface."
image: "../../assets/robot_arm/robot_arm.png"
lightbox: true
---

## Overview
The goal of this project is to demonstrate rapid prototyping of a small-scale robotic arm that can be controlled intuitively. The system automatically activates when a user is detected via an ultrasonic sensor and powers down when no user is present for convenience. An onboard OLED display provides real-time indication of whether the robot is active or inactive.

During operation, the user can choose to control either the pitch motor or second yaw motor by pressing into the stick. A companion Processing-based visualization lists joint angles and the calculated end-effector position, allowing the user to monitor the robot’s configuration in real time.

## Architecture

* **Robot Arm:** 3D-printed arm with multiple degrees of freedom. I initially tried to make the robot purely out of cardboard since this was the most widely available material I had the time, but later incorporated pencils to add more strength and rigidity to the structure. The robot arm has two yaw servo motors and a pitch servo motor, and connects directly to the controller. The next iteration would be to 3D print a enclosure for the electronics and the arm.

* **Controller:** The controller features an ultrasonic sensor, OLED display and a joystick. The breadboard is used to connect the arm, controller, and arduino together. A 6V battery pack is used as the power supply for the motors and arduino. Future improvements to the controller include designing a custom PCB and controller enclosure for much better packaging, as well as incorporating a physical switch to turn on/off the entire system, and relays to disconnect the motors from the power supply when the arm is turned off automatically.

* **Software:** The system software is divided between an Arduino-based controller and a Processing-based visualization that communicate over a serial connection. The Arduino handles sensing, control logic, and actuator commands, including user detection via an ultrasonic sensor and real-time joint control using a joystick with selectable control modes. An onboard OLED display provides immediate feedback on the system’s active state.

Joint angles are transmitted to the host computer, where the Processing application parses the data, performs forward kinematics calculations, and renders a real-time visualization of joint angles and end-effector position. This separation allows reliable embedded control while providing clear, interactive feedback through the GUI.


## Demo
```{=html}
<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;">
  <iframe 
    src="https://www.youtube.com/embed/VY-bdd3kWyU" 
    style="position:absolute;top:0;left:0;width:100%;height:100%;" 
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen>
  </iframe>
</div>
```
## Visualization Code

### Initialization and Setup

The environment is set up by defining basic arm parameters and opening a serial connection to the microcontroller. The serial buffer is cleared to ensure only valid runtime data is processed.

<details open>
<summary>Show code</summary>

```java
import processing.serial.*; // add the serial library
Serial myPort; // define a serial port object to monitor
float armLength = 140; //length of arm in millimeters
float[] armOrigin = {0, 0};
final int armWidth = 10;
final int windowWidth = 1000;
final int windowLength = 1000;

void setup() {

  size(1000, 1300); // set the window size
  println(Serial.list()); // list all available serial ports
  myPort = new Serial(this, Serial.list()[1], 9600); // define input port
  myPort.clear(); // clear the port of any initial junk
  background(255);
}

 ``` 
</details>

### draw()

The draw() function handles real-time visualization of the robot arm by receiving joint angle data from the Arduino over serial communication. There are 3 main components:

* **Serial Communication:** The function first checks if data is available on the serial port, then reads a tab-delimited string containing three joint angles (theta1, pitch, theta2) and converts them from degrees to radians.

* **Forward Kinematics:** Using the received angles and the predefined arm length, the function calculates the 2D positions of key points on the robot arm:
  + Projects the arm length onto the 2D plane using the pitch angle
  + Computes x and y coordinates for the midpoint of the first link, the midpoint of the second link, and the end-effector position
  + Uses trigonometric calculations based on the joint angles to determine each position relative to the origin

* **Arm Projection:** This code projects the arm in 2D space. The code centers the arm on the screen and then draws the base joint. Then for each link, the coordinate frame is moved and rotated to draw the rectangles correctly. pushMatrix() and popMatrix() isolate transformations for each segment.



<details open>
<summary>Show code</summary>

```java
void draw () {

  if (myPort.available () <= 0) { //makes sure port is open
    return;
  }

  //input processing
  String inString = myPort.readStringUntil('\n'); // read input string
  if (inString != null) { // ignore null strings
    background(255);
    textSize(40);
     text("Top View: ", 70, 70);
    inString = trim(inString); // trim off any whitespace
    String[] anglesInput = splitTokens(inString, "\t"); // extract x & y into an array

    float theta1 =  float(anglesInput[0]) * PI/180; //conversion to radians
    float pitch =  float(anglesInput[1]) * PI/180;
    float theta2 =  float(anglesInput[2]) * PI/180;

    //math to find link/manipulator positions using angles and given lengths relative to an origin
    //unit vector directions same as window
    int length2d = int(armLength * cos(pitch));
    int link1_x = int(length2d * cos(theta1) / 2);
    int link2_x = link1_x*2 + int(length2d * cos(theta1 + theta2)/2);
    int end_x = link1_x*2 + int(length2d * cos(theta1 + theta2));
    int link1_y = int(length2d * sin(theta1) / 2);
    int link2_y = link1_y*2 + int(length2d * sin(theta1 + theta2)/2);
    int end_y = link1_y*2 + int( length2d * sin(theta1 + theta2));

    //display angles
    fill(0, 0, 0);    
    
    text("Yaw 1:", 20, 930);
    text(theta1*180/PI + "°", 140, 930);
    fill(128,128,0);
    
    text("Yaw 2:", 320, 930);
    text(theta2*180/PI + "°", 440, 930);
    fill(0,0,0);
    
    text("Pitch :", 620, 930);
    text(pitch*180/PI + "°", 740, 930);
    
    fill(0,128,128);
    text("X:", 20, 970);
    text("Y:", 320, 970);
    text(end_x, 140, 970);
    text(end_y, 440, 970);
    fill(0,0,0);

    //translates/rotates coordinate frame so that arm origin is at the center of the screen
    pushMatrix();
    translate(500, 600);
    ellipse(0,0,10,10);
    pushMatrix(); //save origin frame
    
    //link 1
    pushMatrix(); //creates copy of origin frame for link 1
    rectMode(CENTER); //sets coordinate args to center of rectangle
    translate(link1_x, -link1_y);
    rotate(-theta1);
    rect(0, 0, length2d, armWidth);
    popMatrix();

    //link 2
    pushMatrix();
    translate(link2_x, -link2_y);
    rotate(-1*(theta1 + theta2));
    fill(128,128,0);
    rect(0, 0, length2d, armWidth);// draw rectangle
    popMatrix();
    //end effector
    translate(end_x, -end_y);
      fill(0,128,128);
    ellipse(0,0,10,10);

    //clear stack
    popMatrix();
    popMatrix();
    fill(0,0,0);

  }
}
 ``` 
</details>

## Controller Code

### Initialization and Setup

Pins used for the motor and controller are defined on the arduino. Joystick deadzone and debounce, and ultrasonic sensing distance are also defined. The "on" and "off" image are also defined for the OLED display as a bitmap array.

<details open>
<summary>Show code</summary>

```c
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
 
//oled reset
#define OLED_RESET 4
 
//servo pins
#define yaw1 10
#define pitch 11
#define yaw2 12
 
//sensor pins
#define triggerPin 7
#define echoPin 6
#define xPin 1
#define yPin A0
#define switchPin 2
#define motorSpeed 2
 
//deadzone and debounce for joystick
#define tolerance 200
#define debounce 150
 
Adafruit_SSD1306 display(128, 64, &Wire, OLED_RESET);
 
int startTime, currentTime;  // for timing loop
long duration;
int distance;
//angles range from 0 - 180
float theta1 = 0;
float theta2 = 0;
float theta3 = 0;
String dispImg = "";
bool pitchMode = false;
```
</details>

<details>
<summary>Show OLED Bitmap</summary>

```c
//bitmaps generated from https://diyusthad.com/image2cpp
// 'OFF, 128x64px
const unsigned char offImg[] PROGMEM = {
 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc,
  0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe,
  0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x03, 0xff, 0x80, 0x00, 0x7f, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x1f, 0xff, 0xf0, 0x00, 0x7f, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x3f, 0xff, 0xf8, 0x00, 0x7f, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0xff, 0xff, 0xfc, 0x00, 0x7f, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0x0e,
  0x70, 0x00, 0x01, 0xff, 0xff, 0xfe, 0x00, 0x7f, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0x0e,
  0x70, 0x00, 0x03, 0xff, 0x01, 0xff, 0x00, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x03, 0xfc, 0x00, 0x7f, 0x80, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x07, 0xf8, 0x00, 0x3f, 0xc0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x07, 0xf0, 0x00, 0x1f, 0xc0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x1f, 0xc0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x0f, 0xe0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x0f, 0xe0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x0f, 0xe0, 0x7f, 0xff, 0xf8, 0x0f, 0xff, 0xff, 0x80, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xc0, 0x00, 0x0f, 0xe0, 0x7f, 0xff, 0xf8, 0x0f, 0xff, 0xff, 0x80, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xc0, 0x00, 0x0f, 0xe0, 0x7f, 0xff, 0xf8, 0x0f, 0xff, 0xff, 0x80, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xc0, 0x00, 0x0f, 0xe0, 0x7f, 0xff, 0xf8, 0x0f, 0xff, 0xff, 0x80, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xc0, 0x00, 0x0f, 0xe0, 0x7f, 0xff, 0xf8, 0x0f, 0xff, 0xff, 0x80, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x0f, 0xe0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x0f, 0xe0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xe0, 0x00, 0x0f, 0xe0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x0f, 0xf0, 0x00, 0x1f, 0xc0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x07, 0xf0, 0x00, 0x1f, 0xc0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x07, 0xf8, 0x00, 0x3f, 0xc0, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x03, 0xfc, 0x00, 0x7f, 0x80, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x03, 0xff, 0x03, 0xff, 0x00, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x01, 0xff, 0xff, 0xfe, 0x00, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0xff, 0xff, 0xfc, 0x00, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x3f, 0xff, 0xf8, 0x00, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x0f, 0xff, 0xe0, 0x00, 0x7e, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x01, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
  0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe,
  0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
 
};

// 'ON', 128x64px
const unsigned char onImg[] PROGMEM = {
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff,
  0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
  0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xe0, 0xff, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0x00, 0x01, 0xff, 0xc0, 0x7f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xfe, 0x00, 0x00, 0xff, 0xc0, 0x7f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xc0, 0x3f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f, 0xc0, 0x1f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xf0, 0x07, 0xe0, 0x1f, 0xc0, 0x1f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xf0, 0x1f, 0xf0, 0x0f, 0xc0, 0x0f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xe0, 0x3f, 0xf8, 0x0f, 0xc0, 0x0f, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xe0, 0x7f, 0xfc, 0x07, 0xc0, 0x07, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0x7f, 0xfe, 0x07, 0xc0, 0x03, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xfe, 0x07, 0xc0, 0x03, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xfe, 0x07, 0xc0, 0x01, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xff, 0x03, 0xc0, 0x81, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xff, 0x03, 0xc0, 0xc0, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xff, 0x03, 0xc0, 0xc0, 0x70, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xff, 0x03, 0xc0, 0xe0, 0x70, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xff, 0x03, 0xc0, 0xe0, 0x30, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xfe, 0x03, 0xc0, 0xf0, 0x10, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xfe, 0x07, 0xc0, 0xf8, 0x10, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0xff, 0xfe, 0x07, 0xc0, 0xf8, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xc0, 0x7f, 0xfe, 0x07, 0xc0, 0xfc, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xe0, 0x7f, 0xfc, 0x07, 0xc0, 0xfe, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xe0, 0x3f, 0xf8, 0x0f, 0xc0, 0xfe, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xe0, 0x1f, 0xf0, 0x0f, 0xc0, 0xff, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xf0, 0x07, 0xe0, 0x1f, 0xc0, 0xff, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f, 0xc0, 0xff, 0x80, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xc0, 0xff, 0xc0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xfe, 0x00, 0x00, 0xff, 0xc0, 0xff, 0xc0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0x80, 0x01, 0xff, 0xc0, 0xff, 0xe0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xe0, 0xff, 0xf0, 0x7f, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff,
  0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
  0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
};

```
</details>

<details open>
<summary>Show code</summary>

```c
void setup() {
  //setup timing loop, serial, and pin
  startTime = millis();
 
  pinMode(yaw1, OUTPUT);  //setup digital pin
  pinMode(yaw2, OUTPUT);
  pinMode(pitch, OUTPUT);
  pinMode(switchPin, INPUT_PULLUP);
  pinMode(triggerPin, OUTPUT);  // Sets the trigPin as an Output
  pinMode(echoPin, INPUT);      // Sets the echoPin as an Input
  clearDisplay();
  Serial.begin(9600);
 
 
  //resets servos to initial position
  servoControl(0, pitch);
  servoControl(0, yaw1);
  servoControl(0, yaw2);
}
 ```
</details>

### Main Loop
The microcontroller performs 4 main actions in the loop:

* **Automatic Activation:** The ultrasonic sensor checks if a user is within 60cm. If no user is detected, the system displays "OFF" on the OLED and exits the loop with no motor commands sent, effectively deactivating motor control. When a user approaches, it displays "ON" and proceeds with normal operation.

* **Joystick Control:** The joystick's X-axis always controls the first yaw joint (theta1). The Y-axis control is mode-dependent: in pitch mode, it controls the vertical pitch joint (theta2); otherwise, it controls the second yaw joint (theta3). All joint movements are constrained within 0-180 degrees due to the servo hardware.

* **Mode Switching:** Pressing the joystick button toggles between pitch and yaw control modes for the Y-axis.

* **Data Transmission:** At the end of each loop cycle, all three joint angles are sent via serial communication to the Processing visualization as tab-separated values.

<details open>
<summary>Show code</summary>

```c
void loop() {
 
  //ultrasonic activation
  if (ultraSonic() > 60) {
 
    //clears oled display if needed
    if (dispImg == "on") {
      clearDisplay();
    }
    dispImg = "off";
    drawOff();
    return;
  } else {
    //clears oled display if needed
    if (dispImg == "off") {
      clearDisplay();
    }
    drawOn();
    dispImg = "on";
  }
 
  //joystick inputs update theta
  int dX = readX();
 
  if (dX + theta1 <= 180 && dX + theta1 >= 0) {  //range bounds
    theta1 += dX;
    servoControl(theta1, yaw1);
  }
  int dY = readY();
  if (dY + theta2 <= 180 && dY + theta2 >= 0 && pitchMode) {  //range bounds
    theta2 += dY;
    servoControl(theta2, pitch);
  }
  if (dY + theta3 <= 180 && dY + theta3 >= 0 && !pitchMode) {  //range bounds
    theta3 += dY;
    servoControl(theta3, yaw2);
  }

  //toggle between modes
  if (analogRead(switchPin) <= 5) {
    pitchMode = !pitchMode;
    delay(debounce);  //debounce
  }
 
 
  //angles for processing
  Serial.println(String(theta1) + "\t" + String(theta2) + "\t" + String(theta3));
}
```
</details>

### Helper Functions

* Joystick Reading (readAxis, readX, readY): Reads analog joystick input and converts it into directional commands. The function implements a deadzone (tolerance of 200 around the center value of 507) to ignore small unintentional movements, returning the motor speed multiplied by direction (-1 for left/down, 0 for center, +1 for right/up).

* Servo Control (pwmPulse, servoControl): Generates PWM signals to control the servos without using a servo library. The servoControl function maps desired angles (0-330°) to pulse widths (550-2450 microseconds) and ensures a 20ms period between pulses, which is the standard servo control frequency.

* Ultrasonic Sensing (ultraSonic): Measures distance using an ultrasonic sensor by sending a trigger pulse, measuring the echo return time, and converting it to distance in centimeters using the speed of sound at sea level (0.034 cm/microsecond divided by 2 for round-trip).

* Display Functions (drawOn, drawOff, clearDisplay): Render the predefined "ON" and "OFF" bitmaps to the OLED display and handle display initialization and clearing.

<details open>
<summary>Show code</summary>

```c
int readAxis(int pin) {  //returns 1 if right, zero if centered, -1 if left
  int reading = analogRead(pin);
  if (reading < 507 - tolerance) {
    return -1 * motorSpeed;
  }
  if (reading > 507 + tolerance) {
    return motorSpeed;
  }
  return 0;
}
 
int readX() {
  return readAxis(xPin);
}
int readY() {
  return readAxis(yPin);
}
 
//PWM pulse
void pwmPulse(int period, int pin) {
  digitalWrite(pin, LOW);
  delayMicroseconds(10);
  digitalWrite(pin, HIGH);    // turn the LED on (HIGH is the voltage level)
  delayMicroseconds(period);  // wait for delayLength
  digitalWrite(pin, LOW);     // turn the LED off by making the voltage LOW
}
 
//input- servo angle
void servoControl(float angle, int pin) {
  int tControl = map(angle, 0, 330, 550, 2450);
 
  //timing loop for PWM 20ms period
  currentTime = millis();
  if ((currentTime - startTime) >= 20) {
    pwmPulse(tControl, pin);  //pulse
    startTime = currentTime;
  }
  delay(20);
}
 
int ultraSonic() {
  // reset trigger
  pwmPulse(10, triggerPin);
  duration = pulseIn(echoPin, HIGH);  //listening for echo
  distance = duration * 0.034 / 2;    // distance conversion
  return distance;
}
 
//draws "on" on oled display
void drawOn() {
  display.drawBitmap(0, 0, onImg, 128, 64, WHITE);  // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.display();
}
 
void drawOff() {
  display.drawBitmap(0, 0, offImg, 128, 64, WHITE);  // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.display();
}
 
void clearDisplay() {
  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  display.clearDisplay();
}
```

</details>